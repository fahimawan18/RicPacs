
	<ui:composition xmlns="http://www.w3.org/1999/xhtml"
		xmlns:ui="http://java.sun.com/jsf/facelets"
		xmlns:h="http://java.sun.com/jsf/html"
		xmlns:f="http://java.sun.com/jsf/core"
		xmlns:p="http://primefaces.org/ui"
		template="/pages/includes/templatePage.xhtml">

		<ui:define name="content">

<h:form>
 
				 	
  	<p:panel id="panel2"  header="#{crit.pageTitle}" style="text-align: center;">
					<p:panelGrid style="margin-top:20px; width: 70%; margin: 0 auto"
					columns="4">
					
					
					<p:outputLabel value="Patient Name"></p:outputLabel>
 					 <p:inputText value="#{searchBean.toSearchPatient.patName}"></p:inputText> 

					<p:outputLabel value="Patient ID / Issuer"></p:outputLabel>
					<h:panelGroup>
 					 <p:inputText value="#{searchBean.toSearchPatient.patId}"></p:inputText> /
 					 <p:inputText value="#{searchBean.toSearchPatient.patIdIssuer}"></p:inputText>
 					</h:panelGroup>
 					
 					<p:outputLabel value="Study ID"></p:outputLabel>
 					 <p:inputText value="#{searchBean.toSearchStudy.studyId}"></p:inputText>
					
    				<p:outputLabel value="Study Date / Time From:" />
				    <p:calendar id="datetimeFrom" value="#{searchBean.dateFrom}" pattern="dd/MM/yyyy HH:mm" />
				    <p:outputLabel value="Study Date / Time To:" />
				    <p:calendar id="datetimeTo" value="#{searchBean.dateTo}" pattern="dd/MM/yyyy HH:mm" />
 					
 					 	
				</p:panelGrid>
				</p:panel>
 
 
	<p:commandButton value="Search" icon="fa fa-fw fa-search" update="tbl2"
  	action="#{searchBean.searchStudyData}"/>
 
 
  	<p:commandButton value="Search" icon="fa fa-fw fa-search" update="tbl1" rendered="false"
  	action="#{searchBean.searchPatientsData}"/>
  	 
  	
  	
  	<br/>
  	
  	<p:dataTable value="#{searchBean.patientsList}" 
  	var="cmt" rendered="false"
  	
					paginatorPosition="top" editable="true" rows="12" paginator="true"
					paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
					id="tbl1">

					<f:facet name="header">
        				Patients Data
 
        				<p:commandButton rendered="false"
        				id="toggler" type="button" value="Columns" 
        				style="float:right" icon="ui-icon-calculator" />
        				<p:columnToggler datasource="tbl1" trigger="toggler" rendered="false"/>
    				</f:facet>
					<p:column headerText="Name" sortBy="#{cmt.patName}">
				            <h:outputText value="#{cmt.patName}" />
				        </p:column>
				        
				        
					<p:column headerText="ID" width="10px" sortBy="#{cmt.patId}">
				            <h:outputText value="#{cmt.patId}" />
				    </p:column>
				    
				    <p:column headerText="Issuer" >
				            <h:outputText value="#{cmt.patIdIssuer}" />
				    </p:column>
				    
				    <p:column headerText="Birth Date" >
				            <h:outputText value="#{cmt.patBirthdate}" >
				            	<f:convertDateTime pattern="dd/MM/yyyy HH:mm"></f:convertDateTime>				            
				            </h:outputText>
				    </p:column>
				    
				    <p:column headerText="Sex" >
				            <h:outputText value="#{cmt.patSex}" />
				    </p:column>
				    
				    <p:column headerText="Study Details" >
				            <h:commandLink  
				            actionListener="#{searchBean.testMethod}"
				            action="/pages/search/details/studyDetails.xhtml"
				            target="_blank" rendered="false">
				            View Details-
				            <f:setPropertyActionListener value="#{cmt}" target="#{searchBean.selectedPatient}">
    					</f:setPropertyActionListener>
				            </h:commandLink>
				            
				            <h:commandLink action="#{searchBean.viewStudyDetails}"
				            
				            target="_blank" rendered="true">
				            View Details
				            <f:setPropertyActionListener value="#{cmt}" 
				            target="#{searchBean.selectedPatient}">
    					</f:setPropertyActionListener>
				            </h:commandLink>
				            
				          <p:commandLink id="link" rendered="false" 
				          actionListener="#{searchBean.testMethod}" 
   						 oncomplete="popupwindow('details/studyDetails.jsf', 'newwindow');" >  
    					<h:outputText value="View Details" />
    					<f:setPropertyActionListener value="#{cmt}" target="#{searchBean.selectedPatient}">
    					</f:setPropertyActionListener>
						</p:commandLink>
				    </p:column>
				    
				   
				        <p:column filterBy="#{cmt.eventTime}" rendered="false"
				         headerText="Date - Time" filterMatchMode="contains" sortBy="#{cmt.eventTime}">

				            <h:outputText value="#{cmt.eventTime}" >
				            	<f:convertDateTime pattern="dd/MM/yyyy HH:mm"></f:convertDateTime>
				            </h:outputText>
				        </p:column>
			
				</p:dataTable>
				
		
				
				<br/>
				
			<p:dataTable value="#{searchBean.studiesListMain}" var="study"
  	
					paginatorPosition="top" editable="true" rows="12" paginator="true"
					paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
					id="tbl2">

					<f:facet name="header">
        				Patients/Study Data
 
        				
    				</f:facet>
					<p:column headerText="Name" sortBy="#{study.patientFk.patName}">
				            <h:outputText value="#{study.patientFk.patName}" />
				        </p:column>
				        
				        
					<p:column headerText="ID" width="10px" sortBy="#{study.patientFk.patId}">
				            <h:outputText value="#{study.patientFk.patId}" />
				    </p:column>
				    
				    <p:column headerText="Issuer" >
				            <h:outputText value="#{study.patientFk.patIdIssuer}" />
				    </p:column>
				    
				    
				    
				   	<p:column headerText="Study ID">
            					<h:outputText value="#{study.studyId}"/>
        					</p:column>
        					
        					<p:column headerText="Accession No">
            					<h:outputText value="#{study.accessionNo}"/>
        					</p:column>
        					
        					<p:column headerText="Modality">
            					<h:outputText value="#{study.modsInStudy}"/>
        					</p:column>
        					
        					
        					<p:column headerText="Study Date/Time" >
				            <h:outputText value="#{study.studyDateTime}" >
				            	<f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss"></f:convertDateTime>				            
				            </h:outputText>
				   			</p:column>
				   			
        					<p:column headerText="Description">
            					<h:outputText value="#{study.studyDesc}"/>
        					</p:column>
				    
				    <p:column headerText="View Image">
	            				
	            				<a href="#{crit.weasisPath}#{study.studyIuid}" >Open Web Viewer</a>
        					</p:column>
        					
        					<p:column headerText="Series Details" > 
				            <h:commandLink action="#{searchBean.viewSeriesDetails}"
				            target="_blank" rendered="true">
				            View Details
				            <f:setPropertyActionListener value="#{study}" target="#{searchBean.selectedStudy}">
    						</f:setPropertyActionListener>
				            </h:commandLink>
				   		 </p:column>
				    
				</p:dataTable>
				
				<br/>
				
				
				
</h:form>

<script type="text/javascript">    
function popupwindow(url, title) 
{      
    window.open(url , title, "toolbar=no, scrollbars=yes, resizable=yes, top=170, left=170, width=800, height=600");        
}    
</script>
</ui:define>
	</ui:composition>

